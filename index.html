<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <title>Historique AnomicValue</title>
  <style>
    html, body { margin:0; padding:0; background:#1e1e1e; color:#fff; }
    #chart { width:100%; height:85vh; }
    #controls { text-align:center; padding:8px; }
    button { margin:0 4px; padding:6px 12px; }
    p { padding:20px; }
  </style>
  <script src="https://unpkg.com/lightweight-charts/dist/lightweight-charts.standalone.production.js"></script>
</head>
<body>
  <div id="controls">
    <button onclick="setRange(1)">1d</button>
    <button onclick="setRange(7)">1w</button>
    <button onclick="setRange(30)">1m</button>
    <button onclick="setRange(90)">3m</button>
    <button onclick="setRange(365)">1y</button>
    <button onclick="setRange()">All</button>
  </div>
  <div id="chart"></div>
  <p id="message"></p>

  <script>
    // 1) On lit "item" ou "name" dans l'URL
    const params = new URLSearchParams(location.search);
    const item = params.get("item") || params.get("name");
    if (!item) {
      document.getElementById("message").textContent = "⚠️ Passe ?item=NomDeItem";
      throw "";
    }

    // 2) JSONP vers ton Apps Script
    const script = document.createElement("script");
    script.src = "https://script.google.com/macros/s/AKfycbyX-_XhaZi2M05lP3B67oIxsg9j8oTC0t7VvYHwALlKYCe96ceowiUiwiX6chRwzEwY0Q/exec"
                + "?name=" + encodeURIComponent(item)
                + "&callback=init";
    document.head.appendChild(script);

    // 3) Cette fonction sera appelée avec les données
    function init(data) {
      if (data.error) {
        document.getElementById("message").textContent = data.error;
        return;
      }
      const chart = LightweightCharts.createChart(document.getElementById("chart"), {
        layout: { backgroundColor:"#1e1e1e", textColor:"rgba(255,255,255,0.9)" },
        grid: { vertLines:{color:"#333"}, horzLines:{color:"#333"} },
        timeScale: { timeVisible:true }
      });
      const series = chart.addLineSeries({ color:"cyan", lineWidth:2 });
      series.setData(data);

      // 4) Fonction de zoom
      window.setRange = days => {
        if (!days) return chart.timeScale().fitContent();
        const vr = chart.timeScale().getVisibleRange();
        const to = vr.to;
        chart.timeScale().setVisibleRange({ from: to - days*24*3600, to });
      };
    }
  </script>
</body>
</html>
